# =============================================================================
# AP-ALINK-FPV Configuration File
# =============================================================================

# =============================================================================
# BASIC SETTINGS
# =============================================================================
bitrate_max=19
wificard=8812eu2    # IMPORTANT: If RSSI shows 0, try changing to "8812au"
fps=120

# =============================================================================
# VIDEO QUALITY CONTROL - MCS RATE CONTROL ONLY
# =============================================================================
# NOTE: ROI QP Delta is disabled in recent Majestic builds
# Video quality is now controlled by MCS rate control only
# QP Delta settings removed - no longer functional

# =============================================================================
# SIGNAL PROCESSING & FILTERS
# =============================================================================

# Filter Chain Configuration
# Format: comma-separated filter types (0=Kalman, 1=Low-Pass, 2=Mode, 3=Derivative, 4=2-Pole LPF)
# Examples: "0" (single Kalman), "2,0" (Mode->Kalman), "1,4" (Low-Pass->2-Pole LPF)
rssi_filter_chain=0
dbm_filter_chain=0



# Low-Pass Filter Settings (used by filter types 1 and 4)
lpf_cutoff_freq=2.0
lpf_sample_freq=10.0

# Kalman Filter Parameters
# Process variance - how much the signal is expected to change (lower = more stable)
kalman_rssi_process=0.00001
kalman_dbm_process=0.00001

# Measurement variance - how noisy the measurements are (higher = more noisy)
kalman_rssi_measure=0.1
kalman_dbm_measure=0.5

# =============================================================================
# SIGNAL SAMPLING & TIMING
# =============================================================================

# Frame Sync Control
# 0 = Frame sync DISABLED (maximum responsiveness, higher CPU usage)
# 1 = Frame sync ENABLED (synchronized to target FPS, lower CPU usage)
# Default: 1 (enabled for stability)
frame_sync_enabled=1

# Startup Delay (seconds)
# Delay before starting main control loop to allow SSH connections
# Higher values = more time for SSH, longer startup time
# Default: 5 seconds
startup_delay_seconds=5

# Signal Sampling Configuration
# Number of frames between signal readings (higher = less CPU usage, lower = more responsive)
# At 120 FPS: 1=120Hz sampling, 2=60Hz, 3=40Hz, 5=24Hz, 10=12Hz
signal_sampling_interval=5

# Independent Signal Sampling Frequency (Hz)
# This allows signal sampling independent of frame rate for better responsiveness
# Higher values = more responsive to signal changes, more CPU usage
# Lower values = less CPU usage, less responsive to signal changes
# Recommended: 50-100Hz for racing, 20-50Hz for general use
signal_sampling_freq_hz=50

# =============================================================================
# BITRATE CONTROL & COOLDOWNS
# =============================================================================

# Cooldown System Control
# 0 = Cooldown system DISABLED (immediate bitrate changes)
# 1 = Cooldown system ENABLED (asymmetric timing)
# Default: 1 (enabled for stability)
cooldown_enabled=1

# Asymmetric Cooldown Parameters (only used when cooldown_enabled=1)
# Minimum time between any bitrate changes (ms)
strict_cooldown_ms=200

# Additional time required before increasing bitrate (ms)
up_cooldown_ms=3000

# Emergency Cooldown Configuration
# Time between bitrate decreases (lower = faster response to signal drops)
# At 120 FPS: 50ms=6 frames, 25ms=3 frames, 8ms=1 frame
# For ultra-low latency racing, use 8-25ms (1-3 frames)
emergency_cooldown_ms=50

# Minimum percentage change required to trigger bitrate change
min_change_percent=5



# =============================================================================
# EMERGENCY & SAFETY SETTINGS
# =============================================================================

# Emergency drop settings
emergency_rssi_threshold=30
emergency_bitrate=1000

# Hardware-specific RSSI offset (calibrate for your DIY build)
# Positive values = more sensitive (lower threshold)
# Negative values = less sensitive (higher threshold)
# Default: 0 (no offset)
hardware_rssi_offset=0


# Control Algorithm Configuration
# 0 = PID Controller (smooth transitions, more complex)
# 1 = Simple FIFO (fast, direct, more performant)
# Default: 1 (Simple FIFO for better performance)
control_algorithm=1
# =============================================================================
# PID CONTROLLER (Advanced Users)
# =============================================================================

# PID Controller Parameters
# Proportional gain - immediate response to error (higher = more aggressive)
pid_kp=1.0

# Integral gain - eliminates steady-state error over time (higher = faster correction)
pid_ki=0.05

# Derivative gain - reduces overshoot and oscillation (higher = more damping)
pid_kd=0.4

# =============================================================================
# RACING MODE OVERRIDES CONFIGURATION
# =============================================================================
race_mode=0
# Racing Mode Configuration
# racing_fps is used when racing mode is enabled, fps is used for normal operation
racing_video_resolution=1280x720
racing_exposure=11
racing_fps=120

# Command Execution Method Configuration
# 0 = Use popen() (recommended - better error handling)
# 1 = Use system() (legacy - less reliable on SBCs)
# Default: 0 (popen)
command_execution_method=0
# Racing Mode Filter Chain Configuration (used when race_mode=1)
# Optimized for low latency and fast response
racing_rssi_filter_chain=1
racing_dbm_filter_chain=1

# =============================================================================
# TROUBLESHOOTING
# =============================================================================
# If you see RSSI=0 and VLQ=-1000%+ in debug output:
# 1. Check driver path exists: ls -la /proc/net/rtl88x2eu/wlan0/
# 2. If not found, try: wificard=8812au
# 3. Check alternative paths: ls -la /proc/net/rtl88xxau/wlan0/
# 4. Verify sta_tp_info file exists and contains RSSI data
# 5. Run: sudo ./ap_alink_debug to see diagnostic output